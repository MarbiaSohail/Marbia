# bunyan Changelog

Known issues:

- [issue #58] Can't install to a dir with spaces. This is [this node-gyp
  bug](https://github.com/TooTallNate/node-gyp/issues/65).

## not yet released

(nothing yet)

## 3.0.2 (Expo)

- Add `id` field (UUID v1) to all log records.

## 2.0.0 (beta)

- [issue #499] Fix some `bunyan` CLI exit handling problems.


## 1.8.10

- Ensure that `bunyan` errors out if attempting to use `-p PID` and
  file args at the same time.


## 1.8.9

- [pull #409, issue #246] Revert a change added to the `bunyan` CLI version
  1.0.1 where `SIGINT` was ignored, such that Ctrl+C could not be used to
  terminate bunyan. (By @zbjornson and @davepacheco.)
- [pull #469] Fix a strict mode (`"use strict;"`) error in some versions of
  Safari.


## 1.8.8

- Fix breakage due to a silly last minute "fix 'make check'".


## 1.8.7

Note: *Bad release.* Use 1.8.8 or later.

- [issue #484] Fix breakage due to #474 in previous release.


## 1.8.6

Note: *Bad release.* Use 1.8.7 or later.

- [issue #474] Bunyan's `safeCycles` is too slow when logging large objects.


## 1.8.5

- [issue #401] Improved performance when using disabled log levels.


## 1.8.4

- [issue #454] Fix `src` usage with node v7.


## 1.8.3

- [issue #450] Fix `log.info(null)` crash that resulted from #426 in v1.8.2.


## 1.8.2

- [issue #449] Bump dtrace-provider dep to 0.7.0 to help avoid deprecation
  warnings with node v6 in some cases.
- [issue #426] Ensure `log.info({err: err})` results in a "msg" value, just
  like `log.info(err)`.


## 1.8.1

- [pull #386] Fix bad bug in rotation that could cause a crash with
  error message "cannot start a rotation when already rotating"
  (by Frankie O'Rourke). The bug was introduced in 1.8.0.


## 1.8.0

Note: *Bad release.* An addition in this release broke 'rotating-file' usage.
Use 1.8.1 or later.

- [issue #370] Fix `bunyan -p ...` (i.e. DTrace integration) on node
  4.x and 5.x.
- [issue #329, pull #330] Update the 'rotating-file' stream to do a file
  rotation on initialization if the mtime on the file path indicates the
  last rotation time was missed -- i.e. if the app wasn't running at the
  time. (by Paul Milham.)


## 1.7.1

- [issue #332, pull #355] Ensure stream for type='stream' stream is a writable
  stream. (By Michael Nisi.)

- [issue #344] Fix "rotating-file" Bunyan streams to not miss rotations when configured
  for a period greater than approximately 25 days. Before this there was an issue
  where periods greater than node.js's maximum `setTimeout` length would fail to rotate.
  (By Martijn Schrage.)

- [issue #234, pull #345] Improve `bunyan` CLI rendering of "res" field
  HTTP responses to not show two blank lines for an empty body.
  (By Michael Nisi.)


## 1.7.0

- [pull #311, #302, #310] Improve the runtime environment detection to fix
  running under [NW.js](http://nwjs.io/). Contributions by Adam Lynch, Jeremy
  Ruppel, and Aleksey Timchenko.

- [pull #318] Add `reemitErrorEvents` optional boolean for streams added to a
  Bunyan logger to control whether an "error" event on the stream will be
  re-emitted on the `Logger` instance.

        var log = bunyan.createLogger({
            name: 'foo',
            streams: [
                {
                    type: 'raw',
                    stream: new MyCustomStream(),
                    reemitErrorEvents: true
                }
            ]
        });

  Before this change, "error" events were re-emitted on [`file`
  streams](https://github.com/trentm/node-bunyan#stream-type-file) only. The new
  behaviour is as follows:

    - `reemitErrorEvents` not specified: `file` streams will re-emit error events
      on the Logger instance.
    - `reemitErrorEvents: true`: error events will be re-emitted on the Logger
      for any stream with a `.on()` function -- which includes file streams,
      process.stdout/stderr, and any object that inherits from EventEmitter.
    - `reemitErrorEvents: false`: error events will not be re-emitted for any
      streams.

  Dev Note: Bunyan `Logger` objects don't currently have a `.close()` method
  in which registered error event handlers can be *un*registered. That means
  that a (presumably rare) situation where code adds dozens of Bunyan Logger
  streams to, e.g. process.stdout, and with `reemitErrorEvents: true`, could
  result in leaking Logger objects.

  Original work for allowing "error" re-emitting on non-file streams is
  by Marc Udoff in pull #318.


## 1.6.0

- [pull #304, issue #245] Use [Moment.js][momentjs.com] library to handle
  `bunyan` CLI time formatting in some cases, especially to fix display of
  local time. It is now required for local time formatting (i.e. `bunyan -L`
  or `bunyan --time local`). (By David M. Lee.)

- [pull #252] Fix errant `client_res={}` in `bunyan` CLI rendering, and avoid
  extra newlines in `client_req` rendering in some cases. (By Thomas Heymann.)

- [pull #291, issue #303] Fix `LOG.child(...)` to *not* override the "hostname"
  field of the parent. A use case is when one manually sets "hostname" to
  something other than `os.hostname()`. (By github.com/Cactusbone.)

- [issue #325] Allow one to set `level: 0` in `createLogger` to turn on
  logging for all levels. (Adapted from #336 by github.com/sometimesalready.)

- Add guards (to `resolveLevel`) so that all "level" values are validated.
  Before this, a bogus level like "foo" or -12 or `['some', 'array']` would
  silently be accepted -- with undefined results.

- Doc updates for #340 and #305.

- Update `make test` to test against node 5, 4, 0.12 and 0.10.


## 1.5.1

- [issue #296] Fix `src: true`, which was broken in v1.5.0.


## 1.5.0

Note: *Bad release.* The addition of `'use strict';` broke Bunyan's `src: true`
feature. Use 1.5.1 instead.

- [pull #236, issue #231, issue #223] Fix strict mode in the browser.
- [pull #282, issue #213] Fixes bunyan to work with webpack. By Denis Izmaylov.
- [pull #294] Update to dtrace-provider 0.6 to fix with node 4.0 and io.js 3.0.
- Dropped support for 0.8 (can't install deps easily anymore for running
  test suite). Bump to a recent iojs version for testing.


## 1.4.0

(Bumping minor ver b/c I'm wary of dtrace-provider changes. :)

- [issue #258, pull #259] Update to dtrace-provider 0.5 to fix
  install and tests on recent io.js versions.
- safe-json-stringify@1.0.3 changed output, breaking some tests. Fix those.


## 1.3.6

- [issue #244] Make `bunyan` defensive on `res.header=null`.


## 1.3.5

- [issue #233] Make `bunyan` defensive on res.header as a boolean.
- [issue #242] Make `bunyan` defensive on err.stack not being a string.


## 1.3.4

- Allow `log.child(...)` to work even if the logger is a *sub-class*
  of Bunyan's Logger class.
- [issue #219] Hide 'source-map-support' require from browserify.
- [issue #218] Reset `haveNonRawStreams` on `<logger>.addStream`.


## 1.3.3

- [pull #127] Update to dtrace-provider 0.4.0, which gives io.js 1.x support
  for dtrace-y parts of Bunyan.


## 1.3.2

- [pull #182] Fallback to using the optional 'safe-json-stringify' module
  if `JSON.stringify` throws -- possibly with an enumerable property
  getter than throws. By Martin Gausby.


## 1.3.1

- Export `bunyan.RotatingFileStream` which is needed if one wants to
  customize it. E.g. see issue #194.

- [pull #122] Source Map support for caller line position for [the "src"
  field](https://github.com/trentm/node-bunyan#src). This could be interesting
  for [CoffeeScript](http://coffeescript.org/documentation/docs/sourcemap.html)
  users of Bunyan. By Manuel Schneider.

- [issue #164] Ensure a top-level `level` given in `bunyan.createLogger`
  is *used* for given `streams`. For example, ensure that the following
  results in the stream having a DEBUG level:

        var log = bunyan.createLogger({
            name: 'foo',
            level: 'debug',
            streams: [
                {
                    path: '/var/tmp/foo.log'
                }
            ]
        });

  This was broken in the 1.0.1 release. Between that release and 1.3.0
  the "/var/tmp/foo.log" stream would be at the INFO level (Bunyan's
  default level).


## 1.3.0

- [issue #103] `bunyan -L` (or `bunyan --time local`) to show local time.
  Bunyan log records store `time` in UTC time. Sometimes it is convenient
  to display in local time.

- [issue #205] Fix the "The Bunyan CLI crashed!" checking to properly warn of
  the common failure case when `-c CONDITION` is being used.


## 1.2.4

- [issue #210] Export `bunyan.nameFromLevel` and `bunyan.levelFromName`. It can
  be a pain for custom streams to have to reproduce that.

- [issue #100] Gracefully handle the case of an unbound
  `Logger.{info,debug,...}` being used for logging, e.g.:

        myEmittingThing.on('data', log.info)

  Before this change, bunyan would throw. Now it emits a warning to stderr
  *once*, and then silently ignores those log attempts, e.g.:

        bunyan usage error: /Users/trentm/tm/node-bunyan/foo.js:12: attempt to log with an unbound log method: `this` is: { _events: { data: [Function] } }


## 1.2.3

- [issue #184] Fix log rotation for rotation periods > ~25 days. Before this
  change, a rotation period longer than this could hit [the maximum setTimeout
  delay in node.js](https://github.com/joyent/node/issues/8656). By Daniel Juhl.


## 1.2.2

- Drop the guard that a bunyan Logger level must be between TRACE (10)
  and FATAL (60), inclusive. This allows a trick of setting the level
  to `FATAL + 1` to turn logging off. While the standard named log levels are
  the golden path, then intention was not to get in the way of using
  other level numbers.


## 1.2.1

- [issue #178, #181] Get at least dtrace-provider 0.3.1 for
  optionalDependencies to get a fix for install with decoupled npm (e.g. with
  homebrew's node and npm).


## 1.2.0

- [issue #157] Restore dtrace-provider as a dependency (in
  "optionalDependencies").

  Dtrace-provider version 0.3.0 add build sugar that should eliminate the
  problems from older versions:
  The build is not attempted on Linux and Windows. The build spew is
  *not* emitted by default (use `V=1 npm install` to see it); instead a
  short warning is emitted if the build fails.

  Also, importantly, the new dtrace-provider fixes working with node
  v0.11/0.12.


## 1.1.3

- [issue #165] Include extra `err` fields in `bunyan` CLI output. Before
  this change only the fields part of the typical node.js error stack
  (err.stack, err.message, err.name) would be emitted, even though
  the Bunyan *library* would typically include err.code and err.signal
  in the raw JSON log record.


## 1.1.2

- Fix a breakage in `log.info(err)` on a logger with no serializers.


## 1.1.1

Note: *Bad release.* It breaks `log.info(err)` on a logger with no serializers.
Use version 1.1.2.

- [pull #168] Fix handling of `log.info(err)` to use the `log` Logger's `err`
  serializer if it has one, instead of always using the core Bunyan err
  serializer. (By Mihai Tomescu.)


## 1.1.0

- [issue #162] Preliminary support for [browserify](http://browserify.org/).
  See [the section in the README](../README.md#browserify).


## 1.0.1

- [issues #105, #138, #151] Export `<Logger>.addStream(...)` and
  `<Logger>.addSerializers(...)` to be able to add them after Logger creation.
  Thanks @andreineculau!

- [issue #159] Fix bad handling in construtor guard intending to allow
  creation without "new": `var log = Logger(...)`. Thanks @rmg!

- [issue #156] Smaller install size via .npmignore file.

- [issue #126, #161] Ignore SIGINT (Ctrl+C) when processing stdin. `...| bunyan`
  should expect the preceding process in the pipeline to handle SIGINT. While
  it is doing so, `bunyan` should continue to process any remaining output.
  Thanks @timborodin and @jnordberg!

- [issue #160] Stop using ANSI 'grey' in `bunyan` CLI output, because of the
  problems that causes with Solarized Dark themes (see
  <https://github.com/altercation/solarized/issues/220>).


## 1.0.0

- [issue #87] **Backward incompatible change to `-c CODE`** improving
  performance by over 10x (good!), with a backward incompatible change to
  semantics (unfortunate), and adding some sugar (good!).

  The `-c CODE` implementation was changed to use a JS function for processing
  rather than `vm.runInNewContext`. The latter was specatularly slow, so
  won't be missed. Unfortunately this does mean a few semantic differences in
  the `CODE`, the most noticeable of which is that **`this` is required to
  access the object fields:**

        # Bad. Works with bunyan 0.x but not 1.x.
        $ bunyan -c 'pid === 123' foo.log
        ...

        # Good. Works with all versions of bunyan
        $ bunyan -c 'this.pid === 123' foo.log
        ...

  The old behaviour of `-c` can be restored with the `BUNYAN_EXEC=vm`
  environment variable:

        $ BUNYAN_EXEC=vm bunyan -c 'pid === 123' foo.log
        ...

  Some sugar was also added: the TRACE, DEBUG, ... constants are defined, so
  one can:

        $ bunyan -c 'this.level >= ERROR && this.component === "http"' foo.log
        ...

  And example of the speed improvement on a 10 MiB log example:

        $ time BUNYAN_EXEC=vm bunyan -c 'this.level === ERROR' big.log | cat >slow

        real    0m6.349s
        user    0m6.292s
        